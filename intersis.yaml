---
swagger: '2.0'

################################################################################
#                              API Information                                 #
################################################################################
info:
  version: v0.7
  title: Intersis API
  description: |
    Description of the InterSIS API

    This description can cover multiple lines.
    
    ```
    And you can put Markdown in here!
    ```

################################################################################
#                  Host, Base Path, Schemes and Content Types                  #
################################################################################
host: server.intersis.org
basePath: /v0.7
schemes:
  - https
produces:
  - application/json
consumes:
  - application/json

################################################################################
#                                  Security                                    #
################################################################################
securityDefinitions:
  oauth:
    type: oauth2
    flow: implicit
    authorizationUrl: /o/authorize/?redirect_uri=CALLBACK_URI&scope=SCOPES&state=STATE&client_id=CLIENT_ID
    scopes:
      read-write: to read/modify/create any resources on a user's behalf.
      read: to read any resources on a user's behalf.
      read-rostering: |
        to read the the user's course names, course descriptions, and section rosters,
        not including student names or demographic information.
      read-student-names: read any student names or profile names on the user's behalf
      read-student-profile-names: read any student names on the user's behalf
  key:
    type: apiKey
    in: query
    name: access_token
security:
  - oauth:
    - read-write
    - read
    - read-rostering
    - read-student-names
    - read-student-profile-names
  - key: []

################################################################################
#                                   Parameters                                 #
################################################################################
parameters:
  id:
    name: id
    in: path
    description: The resource identification string
    type: string
    required: true
  staffId:
    name: staffId
    in: path
    description: Staff resource identification string
    required: true
    type: string  
  siteId:
    name: siteId
    in: path
    description: Site resource identification string
    required: true
    type: string
  sectionId:
    name: sectionId
    in: path
    description: Section resource identification string
    required: true
    type: string

################################################################################
#                                           Paths                              #
################################################################################
paths:
  /clients:
    post:
      operationId: registerClient
      summary: Register an OAuth client
      description: Registers your OAuth client with the InterSIS instance.
      parameters:
        - in: formData
          name: redirect_uris
          description: Allowed URIs list, space separated
          required: true
          type: string
        - in: formData
          name: name
          description: A unique name for your client
          required: true
          type: string
      tags:
        - clients
      responses:
        200:
          description: The client object
          schema:
            $ref: '#/definitions/Client'
  /guardians:
    get:
      security:
        - oauth:
          - read-write
          - read
      tags:
        - guardians
      description: List all guardian objects available to you.
      responses:
        "200":
          description: successful operation
          schema:
            type: array
            items:
              $ref: "#/definitions/Guardian"
    post:
      operationId: addGuardian
      description: Create a guardian object.
      parameters:
        - in: formData
          name: family_names
          description: The guardian's family name(s)
          required: true
          type: string
        - in: formData
          name: given_names
          description: The guardians given name(s)
          required: true
          type: string
        - in: formData
          name: email
          description: The guardian's email address
          required: false
          type: string
        - in: formData
          name: hispanic_ethnicity
          description: The guardian's hispanic ethnicity
          required: false
          type: boolean
        - in: formData
          name: sex
          description: The guardian's sex
          required: false
          type: string
          enum:
            - female
            - male
        - in: formData
          name: race
          description: The guardian's race
          required: false
          type: string
      security:
        - oauth:
          - read-write
      tags:
        - guardians
      responses:
        200:
          description: The guardian object
          schema:
            $ref: '#/definitions/Guardian'
                
  /guardians/{id}:
    parameters:
      - $ref: '#/parameters/id'
    get:
      security:
        - oauth:
          - read
      tags:
        - guardians
      description: Get basic information about a guardian.
      responses:
        200:
          description: OK
          schema:
            $ref: '#/definitions/Guardian'
    patch:
      operationId: updateGuardian
      description: Update a guardian object.
      parameters:
        - in: formData
          name: family_names
          description: The guardian's family name(s)
          required: false
          type: string
        - in: formData
          name: given_names
          description: The guardians given name(s)
          required: false
          type: string
        - in: formData
          name: email
          description: The guardian's email address
          required: false
          type: string
        - in: formData
          name: hispanic_ethnicity
          description: The guardian's hispanic ethnicity
          required: false
          type: boolean
        - in: formData
          name: sex
          description: The guardian's sex
          required: false
          type: string
          enum:
            - female
            - male
        - in: formData
          name: race
          description: The guardian's race
          required: false
          type: string
      security:
        - oauth:
          - read-write
      tags:
        - guardians
      responses:
        200:
          description: The guardian object
          schema:
            $ref: '#/definitions/Guardian'
    delete:
      tags:
        - guardians
      summary: Deletes a guardian
      description: ""
      operationId: deleteGuardian
      parameters:
        - $ref: '#/parameters/id'
      responses:
        "204":
          description: Guardian deleted
      security:
        - oauth:
          - read-write
            
  /staff:
    get:
      security:
        - oauth:
          - read
          - read-rostering
      tags:
        - staff
      description: List all staff objects available to you.
      responses:
        200:
          description: OK
          schema:
            type: object
            properties:
              data:
                type: array
                items:
                  $ref: '#/definitions/Staff'
    post:
      operationId: addStaff
      description: Create a staff object.
      parameters:
        - in: formData
          name: family_names
          description: The staff member's family name(s)
          required: true
          type: string
        - in: formData
          name: given_names
          description: The staff member's given name(s)
          required: true
          type: string
        - in: formData
          name: email
          description: The staff member's email address
          required: false
          type: string
        - in: formData
          name: hispanic_ethnicity
          description: The staff member's hispanic ethnicity
          required: false
          type: boolean
        - in: formData
          name: sex
          description: The staff member's sex
          required: false
          type: string
          enum:
            - female
            - male
        - in: formData
          name: race
          description: The staff member's race
          required: false
          type: string
        - in: formData
          name: role
          type: string
          required: true
          description: The staff member's role in the organization.
      security:
        - oauth:
          - read-write
      tags:
        - staff
      responses:
        200:
          description: The staff object
          schema:
            $ref: '#/definitions/Staff'

  /staff/{staffId}:
    parameters:
      - $ref: '#/parameters/staffId'
    get:
      security:
        - oauth:
          - read
      tags:
        - staff
      description: Get basic information about a staff member.
      responses:
        200:
          description: OK
          schema:
            $ref: '#/definitions/Staff'
    patch:
      operationId: updateStaff
      description: Update a staff object.
      parameters:
        - in: formData
          name: family_names
          description: The staff member's family name(s)
          required: false
          type: string
        - in: formData
          name: given_names
          description: The staff member' given name(s)
          required: false
          type: string
        - in: formData
          name: email
          description: The staff member's email address
          required: false
          type: string
        - in: formData
          name: hispanic_ethnicity
          description: The staff member's hispanic ethnicity
          required: false
          type: boolean
        - in: formData
          name: sex
          description: The staff member's sex
          required: false
          type: string
          enum:
            - female
            - male
        - in: formData
          name: race
          description: The staff member's race
          required: false
          type: string
      security:
        - oauth:
          - read-write
      tags:
        - staff
      responses:
        200:
          description: The staff object
          schema:
            $ref: '#/definitions/Staff'
    delete:
      tags:
        - staff
      summary: Deletes a staff member
      description: ""
      operationId: deleteStaff
      responses:
        204:
          description: Staff deleted
      security:
        - oauth:
          - read-write
  
  /staff/{staffId}/sections/{sectionId}:
    parameters: 
      - $ref: '#/parameters/staffId'
      - $ref: '#/parameters/sectionId'
    put:
      tags:
        - staff
      summary: Associates a staff member with a class section.
      description: ""
      operationId: staffAddSection
      responses:
        200:
          description: A section object
          schema:
            $ref: '#/definitions/Section'
      security:
        - oauth:
          - read-write
    delete:
      tags:
        - staff
      summary: Ends the association between a staff member and a class section.
      description: ""
      operationId: staffRemoveSection
      responses:
        204:
          description: Association deleted
      security:
        - oauth:
          - read-write

  /staff/{staffId}/sites/{siteId}:
    parameters:
      - $ref: '#/parameters/staffId'
      - $ref: '#/parameters/siteId'
    put:
      tags:
        - staff
      summary: Associates a staff member with a site.
      description: ""
      operationId: staffAddSite
      responses:
        200:
          description: A site object
          schema:
            $ref: '#/definitions/Site'
      security:
        - oauth:
          - read-write
    delete:
      tags:
        - staff
      summary: Ends the association between a staff member and a site.
      description: ""
      operationId: staffRemoveSite
      responses:
        204:
          description: Association deleted
      security:
        - oauth:
          - read-write
  /students:
    get:
      security:
        - oauth:
          - read
          - read-rostering
      tags:
        - students
      description: List all student objects available to you.
      responses:
        200:
          description: OK
          schema:
            type: object
            properties:
              data:
                type: array
                items:
                  $ref: '#/definitions/Student'
    post:
      operationId: addStudent
      description: Create a student object.
      parameters:
        - name: payload
          in: body
          required: true
          schema:
            $ref: '#/definitions/Student'
      security:
        - oauth:
          - read-write
      tags:
        - students
      responses:
        200:
          description: The student object
          schema:
            $ref: '#/definitions/Student'

  /students/{id}:
    parameters:
      - $ref: '#/parameters/id'
    get:
      security:
        - oauth:
          - read
      tags:
        - students
      description: Get basic information about a student.
      responses:
        200:
          description: OK
          schema:
            $ref: '#/definitions/Student'
    patch:
      operationId: updateStudent
      description: Update a student object.
      parameters:
        - in: formData
          name: family_names
          description: The student's family name(s)
          required: false
          type: string
        - in: formData
          name: given_names
          description: The student's given name(s)
          required: false
          type: string
        - in: formData
          name: email
          description: The student's email address
          required: false
          type: string
        - in: formData
          name: hispanic_ethnicity
          description: The student's hispanic ethnicity
          required: false
          type: boolean
        - in: formData
          name: sex
          description: The student's sex
          required: false
          type: string
          enum:
            - female
            - male
        - in: formData
          name: race
          description: The student's race
          required: false
          type: string
      security:
        - oauth:
          - read-write
      tags:
        - students
      responses:
        200:
          description: The student object
          schema:
            $ref: '#/definitions/Student'
    delete:
      tags:
        - students
      summary: Deletes a student
      description: ""
      operationId: deleteStudent
      responses:
        204:
          description: Student
      security:
        - oauth:
          - read-write

  /users:
    operationId: identifyUser
    get:
      security:
        - oauth:
          - read-write
          - read
          - read-rostering
          - read-student-names
          - read-student-profile-names
      tags:
        - users
      summary: Get the user_id associated with the provided token.
      responses:
        200:
          description: OK
          schema:
            properties:
              id:
                type: string
  /users/{id}/email:
    put:
      operationId: updateUserEmail
      security:
        - oauth:
          - read-write
      tags:
        - users
      summary: Change the user's email address.
      parameters:
        - $ref: '#/parameters/id'
        - in: formData
          name: email
          required: true
          type: string
        - in: formData
          name: password
          required: false
          type: string
      responses:
        200:
          description: OK
  /users/{id}/password:
    operationId: updateUserPassword
    patch:
      security:
        - oauth:
          - read-write
      tags:
        - users
      summary: Change the user's password.
      parameters:
        - $ref: '#/parameters/id'
        - in: formData
          name: password
          required: false
          type: string
        - in: formData
          name: new_password
          required: true
          type: string
      responses:
        200:
          description: OK

################################################################################
#                                 Definitions                                  #
################################################################################
definitions:
  Client:
    properties:
      id:
        type: string
      redirect_uris:
        type: string
      client_type:
        type: string
      authorization_grant_type:
        type: string
      client_secret:
        type: string
      name:
        type: string
  Person:
    properties:
      id:
        type: string
      profile_name:
        type: string
      family_names:
        type: string
      given_names:
        type: string
      email:
        type: string
      hispanic_ethnicity:
        type: boolean
      sex:
        type: string
        enum:
          - female
          - male
      race:
        type: string
      user:
        type: object
        $ref: '#/definitions/User'

  Student:
    description: Model of a student
    allOf:
    - $ref: '#/definitions/Person'
    - type: object
      properties:
        school_student_id:
          type: string
        state_student_id:
          type: string
        sites:
          type: array
          items:
            $ref: '#/definitions/Site'
        sections:
          type: array
          items:
            $ref: '#/definitions/Section'
        guardians:
          type: array
          items:
            $ref: '#/definitions/Guardian'

  Staff:
    description: Model of a staff member
    allOf:
    - $ref: '#/definitions/Person'
    - properties:
        role:
          type: string
        sites:
          type: array
          items:
            $ref: '#/definitions/Site'
        sections:
          type: array
          items:
            $ref: '#/definitions/Section'

  Guardian:
    description: Model of a guardian
    allOf:
    - $ref: '#/definitions/Person'
    - type: object
      properties:
        students:
          type: array
          items:
            $ref: '#/definitions/Reference'
        
  Site:
    type: object
    properties:
      id:
        type: string
      name:
        type: string
      address_line_1:
        type: string
      address_line_2:
        type: string
      city:
        type: string
      state:
        $ref: '#/definitions/states'
      postal_code:
        type: string

  Reference:
    type: object
    properties:
      uri:
        type: string

  Course:
    type: object
    properties:
      id:
        type: string
      name:
        type: string

  Section:
    type: object
    description: A course section
    properties:
      id:
        type: string
      section_name:
        type: string
      course:
        $ref: '#/definitions/Course'
      students:
        type: array
        items:
          $ref: '#/definitions/Reference'

  User:
    description: A user
    properties:
      id:
        type: string
      username:
        type: string
  
  states:
    type: string
    enum:
      - AK
      - AL
      - AR
      - AZ
      - CA
      - CO
      - CT
      - DC
      - DE
      - FL
      - GA
      - HI
      - IA
      - ID
      - IL
      - IN
      - KS
      - KY
      - LA
      - MA
      - MD
      - ME
      - MI
      - MN
      - MO
      - MS
      - MT
      - NC
      - ND
      - NE
      - NH
      - NJ
      - NM
      - NV
      - NY
      - OH
      - OK
      - OR
      - PA
      - RI
      - SC
      - SD
      - TN
      - TX
      - UT
      - VA
      - VT
      - WA
      - WI
      - WV
      - WY
